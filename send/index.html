<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vero - Send Verification</title>
    <link rel="stylesheet" href="../style.css"> <!-- Note: Updated path with ../ to access parent directory -->
</head>
<body>
    <div class="container">
        <h1 class="primary-heading">Send Verification Link</h1>
        <p>Choose a sending method below.</p>


        <!-- Sending Options Section -->
        <div class="sending-options">
            <hr class="separator">

            <!-- SMS Section -->
            <section class="send-method">
                <h3>Send via SMS</h3>
                <p>Enter the recipient's phone number.</p>
                <div>
                    <label for="sms-number">Phone Number:</label>
                    <input type="text" id="sms-number" class="input-field" placeholder="+15555551212">
                </div>
                <a href="#" id="sms-link" class="btn btn-secondary" target="_blank">Send SMS</a>
                <p class="note"><small>Opens your default SMS app.</small></p>
            </section>

            <hr class="separator">

            <!-- Email Section -->
            <section class="send-method">
                <h3>Send via Email</h3>
                <p>Requires server-side setup (e.g., Express/Nodemailer).</p>
                <form id="email-form" action="/send-email" method="POST">
                     <div>
                        <label for="email-address">Email Address:</label>
                        <input type="email" id="email-address" class="input-field" name="email" required placeholder="recipient@example.com">
                    </div>
                    <!-- Hidden fields populated by JS using URL params -->
                    <input type="hidden" id="email-session-key" name="sessionKey">
                    <input type="hidden" id="email-blink-rate" name="blinkRate">
                    <input type="hidden" id="email-verification-url" name="verificationUrl">
                    <button type="submit" class="btn btn-primary">Send Email</button>
                </form>
                <p class="note"><small>Actual sending requires backend logic at /send-email.</small></p>
           </section>
        </div> <!-- /sending-options -->

         <!-- Link back to configuration page -->
         <div style="margin-top: 30px;">
            <a href="../index.html" class="btn btn-outline">&laquo; Back to Configure</a>
        </div>

    </div> <!-- /container -->

    <!-- JavaScript for this page - simplified -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Get URL parameters ---
            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                const results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }

            // Get the session key and blink rate from URL parameters
            const sessionKey = getUrlParameter('sessionKey');
            const blinkRate = getUrlParameter('blinkRate');
            // Get the pre-generated verification URL from parameters
            const verificationUrl = getUrlParameter('verificationUrl');

            // Display received parameters
            document.getElementById('display-session-key').textContent = sessionKey || 'Not Provided';
            document.getElementById('display-blink-rate').textContent = blinkRate || 'Not Provided';

            // Set up hidden form fields
            document.getElementById('email-session-key').value = sessionKey;
            document.getElementById('email-blink-rate').value = blinkRate;
            document.getElementById('email-verification-url').value = verificationUrl;

            // --- SMS Link functionality ---
            const smsLink = document.getElementById('sms-link');
            const smsNumberInput = document.getElementById('sms-number');

            // Update SMS link when phone number changes
            smsNumberInput.addEventListener('input', function() {
                const phoneNumber = this.value.trim();
                
                // Basic validation
                if (phoneNumber && /^\+?[0-9\s\-()]+$/.test(phoneNumber) && verificationUrl) {
                    smsLink.style.opacity = '1';
                    smsLink.style.cursor = 'pointer';
                    // Create SMS link with the verification URL
                    const smsBody = `Click this link to verify liveness with Vero: ${verificationUrl}`;
                    smsLink.href = `sms:${phoneNumber.replace(/[\s\-()]/g, '')}?body=${encodeURIComponent(smsBody)}`;
                } else {
                    smsLink.removeAttribute('href');
                    smsLink.style.opacity = '0.6';
                    smsLink.style.cursor = 'not-allowed';
                }
            });

            // --- Email form handling ---
            document.getElementById('email-form').addEventListener('submit', function(event) {
                const emailAddress = document.getElementById('email-address').value.trim();
                
                if (!emailAddress) {
                    event.preventDefault();
                    alert('Please enter a valid email address.');
                    return;
                }
                
                // Form will submit naturally to the backend endpoint
                console.log('Email will be sent to:', emailAddress);
                console.log('With verification URL:', verificationUrl);
            });
        });
    </script>
</body>
</html>
