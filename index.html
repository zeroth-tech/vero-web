<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags for proper rendering and character encoding -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vero - Configure Session</title>
    <!-- Stylesheet reference -->
    <link rel="stylesheet" href="./style.css">
    <!-- Additional inline styles -->
    <style>
        .inline-fields {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px; /* Adds space between the two fields */
            width: 100%;
        }
        
        .field-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 50%;
        }
        
        .compact-select {
            width: 100%;
            font-family: inherit;
            font-size: inherit;
            height: 45px; /* Match the height of the session key input */
            appearance: auto; /* Keep the dropdown arrow */
        }
        
        
        /* Ensure the input field and the selects have the same width */
        #session-key, .inline-fields {
            width: 100%;
            max-width: 400px; /* Set a maximum width if needed */
        }
    </style>
</head>
<body>
    <!-- Main container -->
    <div class="container">
        <!-- Header section -->
        <h1>Welcome to</h1>
        <img src="assets/vero-logo.svg" alt="Vero Logo" class="vero-logo" />
        <p>Real-time peer-to-peer authentication</p>

        <!-- Configuration Section -->
        <div class="config-section">
            <h2 class="info-heading">Configure Session</h2>
            <br />
            <div>
                <label for="session-key">Session Key:</label>
                <input type="text" id="session-key" class="input-field" placeholder="Enter 5-character hex code" maxlength="5">
            </div>

            <div class="inline-fields">
                <div class="field-group">
                    <label for="blink-rate">Blink Rate (ms):</label>
                    <select id="blink-rate" class="input-field compact-select" name="blinkRate">
                        <option value="100">100 ms</option>
                        <option value="200" selected>200 ms</option>
                        <option value="300">300 ms</option>
                    </select>
                </div>
                
                <div class="field-group">
                    <label for="key-type">Key Type:</label>
                    <select id="key-type" class="input-field compact-select" name="keyType">
                        <option value="s" selected>Session Key</option>
                        <option value="m">Multiplier</option>
                    </select>
                </div>
            </div>
            
            <!-- Add URL preview section -->
            <div style="margin-top: 15px; margin-bottom: 15px;">
                <p><strong>Verification URL:</strong></p>
                <p id="verification-url-preview">https://vero.zeroth.technology/blink?key=XXXXX,blink_rate=200,type=s</p>
            </div>
            
            <button id="send-session-button" class="btn btn-primary">Send Session Key</button>
        </div>

        <!-- Original Footer/Info Text -->
        <div class="footer-info">
             <br />
             <p class="information-text"> If you landed here it was probably by accident, </p>
             <p class="information-text"> you should have been redirected to our blink authentication page.</p>
        </div>

    </div> <!-- /container -->

    <!-- Inline JavaScript for this page only -->
    <script>
        // Wait for DOM content to load
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to elements
            const sessionKeyInput = document.getElementById('session-key');
            const blinkRateSelect = document.getElementById('blink-rate');
            const keyTypeSelect = document.getElementById('key-type');
            const sendButton = document.getElementById('send-session-button');
            const urlPreview = document.getElementById('verification-url-preview');
            
            // Function to update the URL preview
            function updateUrlPreview() {
                const sessionKey = sessionKeyInput.value.trim() || 'XXXXX';
                const blinkRate = blinkRateSelect.value;
                const keyType = keyTypeSelect.value;
                const verificationUrl = `https://vero.zeroth.technology/blink?key=${sessionKey},blink_rate=${blinkRate},type=${keyType}`;
                urlPreview.textContent = verificationUrl;
            }
            
            // Update preview on page load and when inputs change
            updateUrlPreview();
            sessionKeyInput.addEventListener('input', updateUrlPreview);
            blinkRateSelect.addEventListener('change', updateUrlPreview);
            keyTypeSelect.addEventListener('change', updateUrlPreview);

            // Add click event to the Send button
            sendButton.addEventListener('click', function() {
                // Get input values
                const sessionKey = sessionKeyInput.value.trim();
                const blinkRate = blinkRateSelect.value;
                const keyType = keyTypeSelect.value;

                // A) Validate session key (5 character hex code)
                if (!sessionKey) {
                    alert('Please enter a session key.');
                    sessionKeyInput.focus();
                    return;
                }
                
                // Check if the key is 5 characters and a valid hex code
                if (sessionKey.length !== 5 || !/^[0-9A-Fa-f]{5}$/.test(sessionKey)) {
                    alert('Session key must be a 5-character hexadecimal code (0-9, A-F).');
                    sessionKeyInput.focus();
                    return;
                }

                // B) Generate the verification URL in the required format
                const verificationUrl = `https://vero.zeroth.technology/blink?key=${sessionKey},blink_rate=${blinkRate},type=${keyType}`;

                // C) Navigate to the send page with parameters
                window.location.href = `send/index.html?sessionKey=${encodeURIComponent(sessionKey)}&blinkRate=${encodeURIComponent(blinkRate)}&keyType=${encodeURIComponent(keyType)}&verificationUrl=${encodeURIComponent(verificationUrl)}`;
            });
        });
    </script>
</body>
</html>